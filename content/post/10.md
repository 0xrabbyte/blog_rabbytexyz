---
title: "ä¸€ç§å¯¹åŒºé—´æŸ¥æ‰¾æ ‘çš„é€’å½’è½¬å¾ªç¯æ–¹æ³•"
slug: "10"
date: 2021-12-14T00:19:00.000Z
image: "https://s2.loli.net/2021/12/14/cHjL14kXbYsxzhO.jpg"
categories:
- é»˜è®¤åˆ†ç±»
- ACM/ICPC OI
tags:
- ds
---

æœ€è¿‘åœ¨å†™BVHæ ‘çš„æ—¶å€™ç”±äºå¹¶è¡Œè®¡ç®—å¯¹é€’å½’çš„ä¸å‹å¥½,æ•…åªèƒ½æ‰¾ä¸€ç§éé€’å½’æ–¹å¼æ›¿ä»£
æˆ‘å¾ˆè‚¯å®šè¿™ä¸ªä¸œè¥¿æœ‰å®ƒè‡ªå·±çš„åå­—ï¼Œè€Œä¸”ä¼°è®¡äº”åå¹´å‰å°±å·²ç»è¢«å‘ç°äº†ï¼Œä½†æˆ‘æ²¡æ‰¾åˆ°ç›¸åº”èµ„æ–™
(Upd:ç¿»äº†æˆ‘ä¸‰å¹´å‰çš„Bä¹æ”¶è—å¤¹,å¥½åƒæ˜¯å«morriséå†?ğŸ¤”,22.05.09)
## æ¦‚è¿°
æ€è·¯å¾ˆç®€å•.æ¯æ¬¡è¦ä¹ˆèµ°ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹(å¯¹äºäºŒå‰æ ‘å°±æ˜¯å·¦èŠ‚ç‚¹),è¦ä¹ˆèµ°ç¥–å…ˆèŠ‚ç‚¹ä¸­æœ€è¿‘ä¸”ä»æœ‰å­èŠ‚ç‚¹æœªè®¿é—®çš„èŠ‚ç‚¹çš„è¿™ä¸ªæœªè®¿é—®çš„èŠ‚ç‚¹,è¿™æ˜¯å¯ä»¥é€šè¿‡é¢„å¤„ç†å‡ºæ¥çš„
## å¯¹æ¯”
é™¤äº†èƒ½å¤Ÿé’ˆå¯¹å¹¶è¡Œç¨‹åºæˆ–ä¸æ”¯æŒé€’å½’çš„ä¸Šå¤è¯­è¨€è¿›è¡Œé€‚é…,å‡å°æ ˆè°ƒç”¨å¤–,å…¶å®åœ¨æ—¶é—´æ•ˆç‡ä¸Šå¹¶æ²¡æœ‰æå‡,ç”šè‡³å¸¸æ•°è¿˜æ¯”è¾ƒå¤§(é€’å½’çš„å¸¸æ•°è¿œæ¯”æƒ³è±¡ä¸­çš„è¦å°,è‡³å°‘åœ¨è¿™ç§å±‚æ•°è¾ƒå°çš„æƒ…å†µä¸‹æ˜¯è¿™æ ·)
![loj132ä¸­æ­¤ç§æ–¹æ³•ä¸BITå’Œæ™®é€šçº¿æ®µæ ‘çš„å¯¹æ¯”][1]
è€Œä¸”å¦‚æœç”¨è¿™ç§æ–¹æ³•è§£å†³çº¿æ®µæ ‘é—®é¢˜çš„è¯ä¹Ÿä¸èƒ½é€šè¿‡å›æº¯ç»´æŠ¤ä¿¡æ¯,åªèƒ½å†™æ ‡è®°æ°¸ä¹…åŒ–
## å®ç°
æ”¯æŒåŒºé—´åŠ ,åŒºé—´æŸ¥è¯¢çš„çº¿æ®µæ ‘
```cpp
int build(int l, int r, int nt) {
    int u = cnt++;
    T[u].nxt = nt;
    T[u].l = l; T[u].r = r;
    int mid = (l + r) >> 1;
    T[u].add = 0;
    if (l < r) {
        int rc = build(mid + 1, r, nt);
        T[u].lc = build(l, mid, rc);
        T[u].sum = T[T[u].lc].sum + T[rc].sum;
    }
    else
        T[u].sum = a[l];
    return u;
}
long long query(int l, int r) {
    int u = rt;
    long long res = 0;
    while (u != -1) {
        if (T[u].l > r || T[u].r < l) {
            u = T[u].nxt;
            continue;
        }
        res += (std::min(r, T[u].r) - std::max(l, T[u].l) + 1) * T[u].add;
        if (l <= T[u].l && T[u].r <= r) {
            res += T[u].sum;
            u = T[u].nxt;
            continue;
        }
        u = T[u].lc;
    }
    return res;
}
void modify(int l, int r, long long x) {
    int u = rt;
    while (u != -1) {
        if (T[u].l > r || T[u].r < l) {
            u = T[u].nxt;
            continue;
        }
        if (l <= T[u].l && T[u].r <= r) {
            T[u].add += x;
            u = T[u].nxt;
            continue;
        }
        T[u].sum += (std::min(r, T[u].r) - std::max(l, T[u].l) + 1) * x;
        u = T[u].lc;
    }
}
```


  [1]: https://s2.loli.net/2021/12/14/8ZDVY46sHgiJ2Ac.png

---
title: "投稿文章——《换根DP的基本流程》"
slug: "21"
date: 2022-09-26T16:00:00.000Z
draft: true
categories:
- 默认分类
- ACM/ICPC OI
tags:
- dp
---

## 定义
$f_u$表示以$u$为根的目标状态，$h_u$表示以$u$为根的辅助状态。目标状态的计算依赖于辅助状态。
## 流程
在第一次遍历时，规定节点$1$为根。所有目标状态与辅助状态所考察的对象，均为以$1$为根的子树。此时的计算是简单的。
在第二次遍历时，考虑当前DFS遍历到的节点为$u$，子节点为$v$。不妨假设$f_u$和$h_u$均为以$u$为根时的状态。
现在考虑将根从$u$迁移到$v$。在这一过程中，我们需要假定$u$为$v$的子节点，从而用$f'_u$更新$f_v$。
记临时变量$h'_u$表示以$v$为根时，节点$u$的辅助状态；临时变量$f'_u$表示以$v$为根时，节点$u$的目标状态。
接下来，更新节点$v$的辅助状态$h_v$和目标状态$f_v$，使得这两个状态均转化为以$v$为根的值。接下来递归处理节点$v$，完成接下来的换根操作。
## 思想分析
换根操作的核心思想在于，始终保证辅助状态$h_u$和目标状态$f_u$表示以$u$为根的状态值。那么我们在换根时，只需要考虑将根从当前根节点换到它的任意一个子节点处，所需要做的更改操作即可。这也就是我们需要在换根时记录临时变量的原因，换根时$h_u$和$f_u$的值都是不应被更改的。
## 更新顺序
具体分析换根操作可知，$f_v$的更新依赖$f_v,h_v$和$f'_u$，而$f'_u$的更新依赖于$f_u$和$h'_u$。因此我们按照$h'_u,f'_u,h_v$到$f_v$的顺序依次更新即可满足所有依赖关系。
## 例题

### [CEOI2017 Chase](https://loj.ac/p/2485)

状态转移以及换根的细节在上文均有所提及，故这里只讨论状态的设计与转移。

记$f_{u,i}$表示从$u$节点出发，手中有$i$个磁铁，所能得到的最大差值。如果在此时使用磁铁，那么差值将会增加$\sum_{v\in \text{son}(u)}a_v$；否则差值不会发生变化。故得到转移方程：
$$
f_{u,i}=\max_{p\in \text{son}(u)} \left\{\max \left(f_{p,i-1}+\text{sum}_u,f_{p,i}\right)\right\}
$$
使用二元组$\text{mx}_{u,i}=\max_{v\in\text{son}(u)}f_{v,i}$，记录$f_{v,i}$的最大值与次大值。将$\text{sum}$和$\text{mx}$视为$h$，即可套用上文的换根思路。

